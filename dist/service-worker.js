(()=>{function t(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=Array(n);e<n;e++)o[e]=t[e];return o}var n="story-app-".concat("v1"),e=["/index.html","/favicon.png"],o=["https://story-api.dicoding.dev/v1/stories"];self.addEventListener("install",(function(t){console.log("[Service Worker] Installing..."),t.waitUntil(caches.open(n).then((function(t){return console.log("[Service Worker] Caching assets"),t.addAll(e).catch((function(t){console.warn("[Service Worker] Error caching assets:",t)}))}))),self.skipWaiting()})),self.addEventListener("activate",(function(t){console.log("[Service Worker] Activating..."),t.waitUntil(caches.keys().then((function(t){return Promise.all(t.map((function(t){if(t!==n)return console.log("[Service Worker] Deleting old cache:",t),caches.delete(t)})))}))),self.clients.claim()})),self.addEventListener("fetch",(function(t){var r=t.request,i=new URL(r.url);"GET"===r.method&&(o.some((function(t){return i.href.startsWith(t)}))?t.respondWith(caches.open(n).then((function(t){return t.match(r).then((function(n){var e=fetch(r).then((function(n){return t.put(r,n.clone()),n})).catch((function(){return n}));return n||e}))})).catch((function(){return fetch(r)}))):e.some((function(t){return i.href.includes(t)}))?t.respondWith(caches.match(r).then((function(t){return t||fetch(r).then((function(t){return caches.open(n).then((function(n){return n.put(r,t.clone()),t}))}))})).catch((function(){return caches.match("/index.html")}))):t.respondWith(fetch(r).then((function(t){return caches.open(n).then((function(n){return n.put(r,t.clone()),t}))})).catch((function(){return caches.match(r)}))))})),self.addEventListener("push",(function(t){console.log("[Service Worker] Push notification received");var n={title:"Story Map",body:"A new story has been shared!",icon:"/favicon.png",badge:"/favicon.png",tag:"story-notification",requireInteraction:!1};if(t.data)try{var e=t.data.json();n={title:e.title||"Story Map",body:e.body||"A new story has been shared!",icon:e.icon||"/favicon.png",badge:e.badge||"/favicon.png",tag:e.tag||"story-notification",data:e.data||{},actions:e.actions||[],requireInteraction:e.requireInteraction||!1}}catch(e){console.log("[Service Worker] Push data is not JSON:",t.data.text()),n.body=t.data.text()}t.waitUntil(self.registration.showNotification(n.title,{body:n.body,icon:n.icon,badge:n.badge,tag:n.tag,data:n.data,actions:n.actions,requireInteraction:n.requireInteraction}))})),self.addEventListener("notificationclick",(function(n){console.log("[Service Worker] Notification clicked"),n.notification.close();var e=n.notification.data,o="/";n.action?(console.log("[Service Worker] Action clicked:",n.action),"view-story"===n.action&&e.storyId?o="/#/story/".concat(e.storyId):"view-all"===n.action&&(o="/#/")):e.storyId&&(o="/#/story/".concat(e.storyId)),n.waitUntil(clients.matchAll({type:"window"}).then((function(n){var e,r=function(n,e){var o="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=function(n,e){if(n){if("string"==typeof n)return t(n,e);var o={}.toString.call(n).slice(8,-1);return"Object"===o&&n.constructor&&(o=n.constructor.name),"Map"===o||"Set"===o?Array.from(n):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(n,e):void 0}}(n))||e&&n&&"number"==typeof n.length){o&&(n=o);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,s=!1;return{s:function(){o=o.call(n)},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,c=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw c}}}}(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.url===o&&"focus"in i)return i.focus()}}catch(t){r.e(t)}finally{r.f()}if(clients.openWindow)return clients.openWindow(o)})))})),self.addEventListener("notificationclose",(function(t){console.log("[Service Worker] Notification closed")}))})();