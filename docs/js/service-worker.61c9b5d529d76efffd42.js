(()=>{const e="story-app-v1",t=["/index.html","/favicon.png"],o=["https://story-api.dicoding.dev/v1/stories"];self.addEventListener("install",o=>{console.log("[Service Worker] Installing..."),o.waitUntil(caches.open(e).then(e=>(console.log("[Service Worker] Caching assets"),e.addAll(t).catch(e=>{console.warn("[Service Worker] Error caching assets:",e)})))),self.skipWaiting()}),self.addEventListener("activate",t=>{console.log("[Service Worker] Activating..."),t.waitUntil(caches.keys().then(t=>Promise.all(t.map(t=>{if(t!==e)return console.log("[Service Worker] Deleting old cache:",t),caches.delete(t)})))),self.clients.claim()}),self.addEventListener("fetch",n=>{const{request:i}=n,c=new URL(i.url);"GET"===i.method&&(o.some(e=>c.href.startsWith(e))?n.respondWith(caches.open(e).then(e=>e.match(i).then(t=>{const o=fetch(i).then(t=>(e.put(i,t.clone()),t)).catch(()=>t);return t||o})).catch(()=>fetch(i))):t.some(e=>c.href.includes(e))?n.respondWith(caches.match(i).then(t=>t||fetch(i).then(t=>caches.open(e).then(e=>(e.put(i,t.clone()),t)))).catch(()=>caches.match("/index.html"))):n.respondWith(fetch(i).then(t=>caches.open(e).then(e=>(e.put(i,t.clone()),t))).catch(()=>caches.match(i))))}),self.addEventListener("push",e=>{console.log("[Service Worker] Push notification received");let t={title:"Story Map",body:"A new story has been shared!",icon:"/favicon.png",badge:"/favicon.png",tag:"story-notification",requireInteraction:!1};if(e.data)try{const o=e.data.json();t={title:o.title||"Story Map",body:o.body||"A new story has been shared!",icon:o.icon||"/favicon.png",badge:o.badge||"/favicon.png",tag:o.tag||"story-notification",data:o.data||{},actions:o.actions||[],requireInteraction:o.requireInteraction||!1}}catch(o){console.log("[Service Worker] Push data is not JSON:",e.data.text()),t.body=e.data.text()}e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:t.icon,badge:t.badge,tag:t.tag,data:t.data,actions:t.actions,requireInteraction:t.requireInteraction}))}),self.addEventListener("notificationclick",e=>{console.log("[Service Worker] Notification clicked"),e.notification.close();const t=e.notification.data;let o="/";e.action?(console.log("[Service Worker] Action clicked:",e.action),"view-story"===e.action&&t.storyId?o=`/#/story/${t.storyId}`:"view-all"===e.action&&(o="/#/")):t.storyId&&(o=`/#/story/${t.storyId}`),e.waitUntil(clients.matchAll({type:"window"}).then(e=>{for(let t of e)if(t.url===o&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow(o)}))}),self.addEventListener("notificationclose",e=>{console.log("[Service Worker] Notification closed")})})();
//# sourceMappingURL=service-worker.61c9b5d529d76efffd42.js.map