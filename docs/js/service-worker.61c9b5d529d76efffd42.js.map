{"version":3,"file":"js/service-worker.61c9b5d529d76efffd42.js","mappings":"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","sources":["webpack://app-starter-project-with-webpack/./src/service-worker.js"],"sourcesContent":["// Service Worker for Push Notifications and Caching\r\n\r\nconst CACHE_VERSION = 'v1';\r\nconst CACHE_NAME = `story-app-${CACHE_VERSION}`;\r\n\r\n// Cache strategies\r\nconst CACHE_FIRST_ASSETS = [\r\n  '/index.html',\r\n  '/favicon.png',\r\n];\r\n\r\nconst STALE_WHILE_REVALIDATE_URLS = [\r\n  'https://story-api.dicoding.dev/v1/stories',\r\n];\r\n\r\n// Install event - cache assets\r\nself.addEventListener('install', (event) => {\r\n  console.log('[Service Worker] Installing...');\r\n  event.waitUntil(\r\n    caches.open(CACHE_NAME).then((cache) => {\r\n      console.log('[Service Worker] Caching assets');\r\n      return cache.addAll(CACHE_FIRST_ASSETS).catch((err) => {\r\n        console.warn('[Service Worker] Error caching assets:', err);\r\n      });\r\n    })\r\n  );\r\n  self.skipWaiting();\r\n});\r\n\r\n// Activate event - clean up old caches\r\nself.addEventListener('activate', (event) => {\r\n  console.log('[Service Worker] Activating...');\r\n  event.waitUntil(\r\n    caches.keys().then((cacheNames) => {\r\n      return Promise.all(\r\n        cacheNames.map((cacheName) => {\r\n          if (cacheName !== CACHE_NAME) {\r\n            console.log('[Service Worker] Deleting old cache:', cacheName);\r\n            return caches.delete(cacheName);\r\n          }\r\n        })\r\n      );\r\n    })\r\n  );\r\n  self.clients.claim();\r\n});\r\n\r\n// Fetch event - implement caching strategies\r\nself.addEventListener('fetch', (event) => {\r\n  const { request } = event;\r\n  const url = new URL(request.url);\r\n\r\n  // Skip non-GET requests\r\n  if (request.method !== 'GET') {\r\n    return;\r\n  }\r\n\r\n  // Stale-while-revalidate for API calls\r\n  if (STALE_WHILE_REVALIDATE_URLS.some((apiUrl) => url.href.startsWith(apiUrl))) {\r\n    event.respondWith(\r\n      caches.open(CACHE_NAME).then((cache) => {\r\n        return cache.match(request).then((cachedResponse) => {\r\n          const fetchPromise = fetch(request).then((networkResponse) => {\r\n            cache.put(request, networkResponse.clone());\r\n            return networkResponse;\r\n          }).catch(() => cachedResponse);\r\n\r\n          return cachedResponse || fetchPromise;\r\n        });\r\n      }).catch(() => fetch(request))\r\n    );\r\n    return;\r\n  }\r\n\r\n  // Cache-first for static assets\r\n  if (CACHE_FIRST_ASSETS.some((asset) => url.href.includes(asset))) {\r\n    event.respondWith(\r\n      caches.match(request).then((cachedResponse) => {\r\n        return cachedResponse || fetch(request).then((networkResponse) => {\r\n          return caches.open(CACHE_NAME).then((cache) => {\r\n            cache.put(request, networkResponse.clone());\r\n            return networkResponse;\r\n          });\r\n        });\r\n      }).catch(() => {\r\n        // Return offline fallback\r\n        return caches.match('/index.html');\r\n      })\r\n    );\r\n    return;\r\n  }\r\n\r\n  // Network first for other requests\r\n  event.respondWith(\r\n    fetch(request)\r\n      .then((networkResponse) => {\r\n        return caches.open(CACHE_NAME).then((cache) => {\r\n          cache.put(request, networkResponse.clone());\r\n          return networkResponse;\r\n        });\r\n      })\r\n      .catch(() => {\r\n        return caches.match(request);\r\n      })\r\n  );\r\n});\r\n\r\n// Handle push notifications\r\nself.addEventListener('push', (event) => {\r\n  console.log('[Service Worker] Push notification received');\r\n\r\n  let notificationData = {\r\n    title: 'Story Map',\r\n    body: 'A new story has been shared!',\r\n    icon: '/favicon.png',\r\n    badge: '/favicon.png',\r\n    tag: 'story-notification',\r\n    requireInteraction: false,\r\n  };\r\n\r\n  if (event.data) {\r\n    try {\r\n      const data = event.data.json();\r\n      notificationData = {\r\n        title: data.title || 'Story Map',\r\n        body: data.body || 'A new story has been shared!',\r\n        icon: data.icon || '/favicon.png',\r\n        badge: data.badge || '/favicon.png',\r\n        tag: data.tag || 'story-notification',\r\n        data: data.data || {},\r\n        actions: data.actions || [],\r\n        requireInteraction: data.requireInteraction || false,\r\n      };\r\n    } catch (err) {\r\n      console.log('[Service Worker] Push data is not JSON:', event.data.text());\r\n      notificationData.body = event.data.text();\r\n    }\r\n  }\r\n\r\n  event.waitUntil(\r\n    self.registration.showNotification(notificationData.title, {\r\n      body: notificationData.body,\r\n      icon: notificationData.icon,\r\n      badge: notificationData.badge,\r\n      tag: notificationData.tag,\r\n      data: notificationData.data,\r\n      actions: notificationData.actions,\r\n      requireInteraction: notificationData.requireInteraction,\r\n    })\r\n  );\r\n});\r\n\r\n// Handle notification click\r\nself.addEventListener('notificationclick', (event) => {\r\n  console.log('[Service Worker] Notification clicked');\r\n  event.notification.close();\r\n\r\n  const data = event.notification.data;\r\n  let urlToOpen = '/';\r\n\r\n  // Handle action button clicks\r\n  if (event.action) {\r\n    console.log('[Service Worker] Action clicked:', event.action);\r\n    if (event.action === 'view-story' && data.storyId) {\r\n      urlToOpen = `/#/story/${data.storyId}`;\r\n    } else if (event.action === 'view-all') {\r\n      urlToOpen = '/#/';\r\n    }\r\n  } else if (data.storyId) {\r\n    // Default notification click\r\n    urlToOpen = `/#/story/${data.storyId}`;\r\n  }\r\n\r\n  event.waitUntil(\r\n    clients.matchAll({ type: 'window' }).then((clientList) => {\r\n      // Check if any client is already open\r\n      for (let client of clientList) {\r\n        if (client.url === urlToOpen && 'focus' in client) {\r\n          return client.focus();\r\n        }\r\n      }\r\n      // Otherwise open a new window\r\n      if (clients.openWindow) {\r\n        return clients.openWindow(urlToOpen);\r\n      }\r\n    })\r\n  );\r\n});\r\n\r\n// Handle notification close\r\nself.addEventListener('notificationclose', (event) => {\r\n  console.log('[Service Worker] Notification closed');\r\n});\r\n"],"names":["CACHE_NAME","CACHE_FIRST_ASSETS","STALE_WHILE_REVALIDATE_URLS","self","addEventListener","event","console","log","waitUntil","caches","open","then","cache","addAll","catch","err","warn","skipWaiting","keys","cacheNames","Promise","all","map","cacheName","delete","clients","claim","request","url","URL","method","some","apiUrl","href","startsWith","respondWith","match","cachedResponse","fetchPromise","fetch","networkResponse","put","clone","asset","includes","notificationData","title","body","icon","badge","tag","requireInteraction","data","json","actions","text","registration","showNotification","notification","close","urlToOpen","action","storyId","matchAll","type","clientList","client","focus","openWindow"],"sourceRoot":""}