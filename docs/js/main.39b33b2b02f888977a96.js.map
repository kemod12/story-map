{"version":3,"file":"js/main.39b33b2b02f888977a96.js","mappings":"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","sources":["webpack://app-starter-project-with-webpack/webpack/runtime/chunk loaded","webpack://app-starter-project-with-webpack/./src/scripts/utils/map-service.js","webpack://app-starter-project-with-webpack/./src/scripts/config.js","webpack://app-starter-project-with-webpack/./src/scripts/data/api.js","webpack://app-starter-project-with-webpack/./src/scripts/utils/indexeddb-service.js","webpack://app-starter-project-with-webpack/./src/scripts/utils/push-notification-service.js","webpack://app-starter-project-with-webpack/./src/scripts/routes/routes.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/home/home-page.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/about/about-page.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/add-story/add-story-page.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/login/login-page.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/register/register-page.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/notification-settings/notification-settings-page.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/offline-data/offline-data-page.js","webpack://app-starter-project-with-webpack/./src/scripts/routes/url-parser.js","webpack://app-starter-project-with-webpack/./src/scripts/pages/app.js","webpack://app-starter-project-with-webpack/./src/scripts/index.js","webpack://app-starter-project-with-webpack/webpack/bootstrap","webpack://app-starter-project-with-webpack/webpack/runtime/compat get default export","webpack://app-starter-project-with-webpack/webpack/runtime/define property getters","webpack://app-starter-project-with-webpack/webpack/runtime/hasOwnProperty shorthand","webpack://app-starter-project-with-webpack/webpack/runtime/make namespace object","webpack://app-starter-project-with-webpack/webpack/runtime/publicPath","webpack://app-starter-project-with-webpack/webpack/runtime/jsonp chunk loading","webpack://app-starter-project-with-webpack/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","import L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nclass MapService {\r\n  #map = null;\r\n  #markers = [];\r\n  #defaultCenter = [-6.2088, 106.8456]; // Jakarta, Indonesia\r\n  #defaultZoom = 13;\r\n\r\n  constructor() {\r\n    // Fix for marker icon in webpack\r\n    delete L.Icon.Default.prototype._getIconUrl;\r\n    L.Icon.Default.mergeOptions({\r\n      iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\r\n      iconUrl: require('leaflet/dist/images/marker-icon.png'),\r\n      shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\r\n    });\r\n  }\r\n\r\n  initializeMap(containerId, options = {}) {\r\n    const { center = this.#defaultCenter, zoom = this.#defaultZoom } = options;\r\n\r\n    this.#map = L.map(containerId).setView(center, zoom);\r\n\r\n    // Add default OSM tile layer\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; OpenStreetMap contributors'\r\n    }).addTo(this.#map);\r\n\r\n    // Add satellite view tile layer\r\n    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\r\n      attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'\r\n    });\r\n\r\n    // Add layer control\r\n    const baseMaps = {\r\n      \"Street View\": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n        attribution: '&copy; OpenStreetMap contributors'\r\n      }),\r\n      \"Satellite View\": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\r\n        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'\r\n      })\r\n    };\r\n\r\n    L.control.layers(baseMaps).addTo(this.#map);\r\n\r\n    return this.#map;\r\n  }\r\n\r\n  addMarker(lat, lng, options = {}) {\r\n    const marker = L.marker([lat, lng], options).addTo(this.#map);\r\n    this.#markers.push(marker);\r\n    return marker;\r\n  }\r\n\r\n  removeMarker(marker) {\r\n    const index = this.#markers.indexOf(marker);\r\n    if (index > -1) {\r\n      this.#markers.splice(index, 1);\r\n      this.#map.removeLayer(marker);\r\n    }\r\n  }\r\n\r\n  clearMarkers() {\r\n    this.#markers.forEach(marker => this.#map.removeLayer(marker));\r\n    this.#markers = [];\r\n  }\r\n\r\n  setView(lat, lng, zoom) {\r\n    this.#map.setView([lat, lng], zoom);\r\n  }\r\n\r\n  on(event, callback) {\r\n    this.#map.on(event, callback);\r\n  }\r\n\r\n  getMap() {\r\n    return this.#map;\r\n  }\r\n}\r\n\r\nexport default new MapService();","const CONFIG = {\r\n  BASE_URL: 'API_BASE_URL',\r\n};\r\n\r\nexport default CONFIG;\r\n","import CONFIG from '../config';\r\n\r\nconst BASE_URL = 'https://story-api.dicoding.dev/v1';\r\n\r\nclass StoryService {\r\n  async register(name, email, password) {\r\n    const response = await fetch(`${BASE_URL}/register`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        name,\r\n        email,\r\n        password,\r\n      }),\r\n    });\r\n\r\n    const responseJson = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(responseJson.message);\r\n    }\r\n\r\n    return responseJson;\r\n  }\r\n\r\n  async login(email, password) {\r\n    const response = await fetch(`${BASE_URL}/login`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        email,\r\n        password,\r\n      }),\r\n    });\r\n\r\n    const responseJson = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(responseJson.message);\r\n    }\r\n\r\n    return responseJson;\r\n  }\r\n\r\n  async getAllStories(token) {\r\n    const response = await fetch(`${BASE_URL}/stories`, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n\r\n    const responseJson = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(responseJson.message);\r\n    }\r\n\r\n    return responseJson.listStory;\r\n  }\r\n\r\n  async addStory(token, { description, photo, lat, lon }) {\r\n    const formData = new FormData();\r\n    formData.append('description', description);\r\n    formData.append('photo', photo);\r\n    \r\n    if (lat && lon) {\r\n      formData.append('lat', lat.toString());\r\n      formData.append('lon', lon.toString());\r\n    }\r\n\r\n    const response = await fetch(`${BASE_URL}/stories`, {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n      body: formData,\r\n    });\r\n\r\n    const responseJson = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(responseJson.message);\r\n    }\r\n\r\n    return responseJson;\r\n  }\r\n}\r\n\r\nexport default new StoryService();","// IndexedDB Service for data persistence and offline support\r\n\r\nexport default class IndexedDBService {\r\n  constructor(dbName = 'StoryAppDB', version = 1) {\r\n    this.dbName = dbName;\r\n    this.version = version;\r\n    this.db = null;\r\n  }\r\n\r\n  // Initialize database with object stores\r\n  async init() {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(this.dbName, this.version);\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error opening database');\r\n        reject(request.error);\r\n      };\r\n\r\n      request.onsuccess = () => {\r\n        this.db = request.result;\r\n        console.log('[IndexedDB] Database opened successfully');\r\n        resolve(this.db);\r\n      };\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = event.target.result;\r\n\r\n        // Create object stores if they don't exist\r\n        if (!db.objectStoreNames.contains('stories')) {\r\n          const storyStore = db.createObjectStore('stories', { keyPath: 'id' });\r\n          storyStore.createIndex('email', 'email', { unique: false });\r\n          storyStore.createIndex('createdAt', 'createdAt', { unique: false });\r\n          console.log('[IndexedDB] Created stories object store');\r\n        }\r\n\r\n        if (!db.objectStoreNames.contains('pendingStories')) {\r\n          db.createObjectStore('pendingStories', { keyPath: 'id', autoIncrement: true });\r\n          console.log('[IndexedDB] Created pendingStories object store');\r\n        }\r\n\r\n        if (!db.objectStoreNames.contains('pushSubscription')) {\r\n          db.createObjectStore('pushSubscription', { keyPath: 'key' });\r\n          console.log('[IndexedDB] Created pushSubscription object store');\r\n        }\r\n\r\n        if (!db.objectStoreNames.contains('cache')) {\r\n          db.createObjectStore('cache', { keyPath: 'url' });\r\n          console.log('[IndexedDB] Created cache object store');\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  // Add or update a story\r\n  async addStory(story) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['stories'], 'readwrite');\r\n      const store = transaction.objectStore('stories');\r\n      const request = store.put(story);\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] Story saved:', story.id);\r\n        resolve(request.result);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error saving story');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Get all stories\r\n  async getAllStories() {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['stories'], 'readonly');\r\n      const store = transaction.objectStore('stories');\r\n      const request = store.getAll();\r\n\r\n      request.onsuccess = () => {\r\n        resolve(request.result);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error fetching stories');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Get story by ID\r\n  async getStory(id) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['stories'], 'readonly');\r\n      const store = transaction.objectStore('stories');\r\n      const request = store.get(id);\r\n\r\n      request.onsuccess = () => {\r\n        resolve(request.result);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error fetching story');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Delete a story\r\n  async deleteStory(id) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['stories'], 'readwrite');\r\n      const store = transaction.objectStore('stories');\r\n      const request = store.delete(id);\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] Story deleted:', id);\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error deleting story');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Clear all stories\r\n  async clearStories() {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['stories'], 'readwrite');\r\n      const store = transaction.objectStore('stories');\r\n      const request = store.clear();\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] All stories cleared');\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error clearing stories');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Search stories with filters\r\n  async searchStories(filters = {}) {\r\n    const allStories = await this.getAllStories();\r\n\r\n    return allStories.filter((story) => {\r\n      if (filters.query) {\r\n        const query = filters.query.toLowerCase();\r\n        const matchesName = story.name?.toLowerCase().includes(query);\r\n        const matchesDescription = story.description?.toLowerCase().includes(query);\r\n        if (!matchesName && !matchesDescription) return false;\r\n      }\r\n\r\n      if (filters.email && story.email !== filters.email) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }\r\n\r\n  // Add pending story (offline)\r\n  async addPendingStory(story) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['pendingStories'], 'readwrite');\r\n      const store = transaction.objectStore('pendingStories');\r\n      const request = store.add(story);\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] Pending story saved:', request.result);\r\n        resolve(request.result);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error saving pending story');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Get all pending stories\r\n  async getPendingStories() {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['pendingStories'], 'readonly');\r\n      const store = transaction.objectStore('pendingStories');\r\n      const request = store.getAll();\r\n\r\n      request.onsuccess = () => {\r\n        resolve(request.result);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error fetching pending stories');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Delete pending story\r\n  async deletePendingStory(id) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['pendingStories'], 'readwrite');\r\n      const store = transaction.objectStore('pendingStories');\r\n      const request = store.delete(id);\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] Pending story deleted:', id);\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error deleting pending story');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Save push subscription\r\n  async savePushSubscription(subscription) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['pushSubscription'], 'readwrite');\r\n      const store = transaction.objectStore('pushSubscription');\r\n      const request = store.put({\r\n        key: 'subscription',\r\n        data: subscription,\r\n        timestamp: new Date().getTime(),\r\n      });\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] Push subscription saved');\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error saving push subscription');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Get push subscription\r\n  async getPushSubscription() {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['pushSubscription'], 'readonly');\r\n      const store = transaction.objectStore('pushSubscription');\r\n      const request = store.get('subscription');\r\n\r\n      request.onsuccess = () => {\r\n        resolve(request.result?.data || null);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error fetching push subscription');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Delete push subscription\r\n  async deletePushSubscription() {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['pushSubscription'], 'readwrite');\r\n      const store = transaction.objectStore('pushSubscription');\r\n      const request = store.delete('subscription');\r\n\r\n      request.onsuccess = () => {\r\n        console.log('[IndexedDB] Push subscription deleted');\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error('[IndexedDB] Error deleting push subscription');\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Cache API response\r\n  async cacheData(url, data) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['cache'], 'readwrite');\r\n      const store = transaction.objectStore('cache');\r\n      const request = store.put({\r\n        url,\r\n        data,\r\n        timestamp: new Date().getTime(),\r\n      });\r\n\r\n      request.onsuccess = () => {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Get cached data\r\n  async getCachedData(url) {\r\n    if (!this.db) throw new Error('[IndexedDB] Database not initialized');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction(['cache'], 'readonly');\r\n      const store = transaction.objectStore('cache');\r\n      const request = store.get(url);\r\n\r\n      request.onsuccess = () => {\r\n        resolve(request.result?.data || null);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  // Close database\r\n  close() {\r\n    if (this.db) {\r\n      this.db.close();\r\n      console.log('[IndexedDB] Database closed');\r\n    }\r\n  }\r\n}\r\n","// Push Notification Service\r\n\r\nexport default class PushNotificationService {\r\n  constructor() {\r\n    this.serviceWorkerReady = false;\r\n    this.subscribed = false;\r\n  }\r\n\r\n  // Initialize service worker and request notification permission\r\n  async init() {\r\n    if (!('serviceWorker' in navigator)) {\r\n      console.warn('[PushNotification] Service Worker not supported');\r\n      return false;\r\n    }\r\n\r\n    if (!('PushManager' in window)) {\r\n      console.warn('[PushNotification] Push Manager not supported');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const registration = await navigator.serviceWorker.register('/service-worker.js', {\r\n        scope: '/',\r\n      });\r\n      console.log('[PushNotification] Service Worker registered', registration);\r\n      this.serviceWorkerReady = true;\r\n      \r\n      // Check current subscription status\r\n      const subscription = await registration.pushManager.getSubscription();\r\n      this.subscribed = subscription !== null;\r\n      \r\n      return true;\r\n    } catch (err) {\r\n      console.error('[PushNotification] Service Worker registration failed:', err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Request notification permission\r\n  async requestPermission() {\r\n    if (!('Notification' in window)) {\r\n      console.warn('[PushNotification] Notification not supported');\r\n      return false;\r\n    }\r\n\r\n    if (Notification.permission === 'granted') {\r\n      return true;\r\n    }\r\n\r\n    if (Notification.permission === 'denied') {\r\n      console.warn('[PushNotification] Notification permission denied');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const permission = await Notification.requestPermission();\r\n      return permission === 'granted';\r\n    } catch (err) {\r\n      console.error('[PushNotification] Permission request failed:', err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Subscribe to push notifications\r\n  async subscribe(vapidPublicKey) {\r\n    if (!this.serviceWorkerReady) {\r\n      console.error('[PushNotification] Service Worker not ready');\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      \r\n      const subscription = await registration.pushManager.subscribe({\r\n        userVisibleOnly: true,\r\n        applicationServerKey: this.urlBase64ToUint8Array(vapidPublicKey),\r\n      });\r\n\r\n      console.log('[PushNotification] Subscription successful', subscription);\r\n      this.subscribed = true;\r\n      \r\n      return subscription;\r\n    } catch (err) {\r\n      console.error('[PushNotification] Subscription failed:', err);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Unsubscribe from push notifications\r\n  async unsubscribe() {\r\n    if (!this.serviceWorkerReady) {\r\n      console.error('[PushNotification] Service Worker not ready');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      const subscription = await registration.pushManager.getSubscription();\r\n\r\n      if (subscription) {\r\n        await subscription.unsubscribe();\r\n        console.log('[PushNotification] Unsubscription successful');\r\n        this.subscribed = false;\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    } catch (err) {\r\n      console.error('[PushNotification] Unsubscription failed:', err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Get current subscription\r\n  async getSubscription() {\r\n    if (!this.serviceWorkerReady) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      return await registration.pushManager.getSubscription();\r\n    } catch (err) {\r\n      console.error('[PushNotification] Failed to get subscription:', err);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Check if user is subscribed\r\n  async isSubscribed() {\r\n    const subscription = await this.getSubscription();\r\n    return subscription !== null;\r\n  }\r\n\r\n  // Convert VAPID public key\r\n  urlBase64ToUint8Array(base64String) {\r\n    const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    const base64 = (base64String + padding)\r\n      .replace(/\\-/g, '+')\r\n      .replace(/_/g, '/');\r\n\r\n    const rawData = window.atob(base64);\r\n    const outputArray = new Uint8Array(rawData.length);\r\n\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n      outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n\r\n    return outputArray;\r\n  }\r\n\r\n  // Send subscription to server for backend push notifications\r\n  async sendSubscriptionToServer(subscription, token) {\r\n    try {\r\n      const response = await fetch('https://story-api.dicoding.dev/v1/notifications/subscribe', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify(subscription),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Server error: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      console.log('[PushNotification] Subscription sent to server:', data);\r\n      return data;\r\n    } catch (err) {\r\n      console.error('[PushNotification] Failed to send subscription to server:', err);\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // Show a local notification (for testing)\r\n  async showLocalNotification(title, options = {}) {\r\n    if (!this.serviceWorkerReady) {\r\n      console.error('[PushNotification] Service Worker not ready');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      await registration.showNotification(title, {\r\n        icon: '/favicon.png',\r\n        badge: '/favicon.png',\r\n        tag: 'story-notification',\r\n        requireInteraction: false,\r\n        ...options,\r\n      });\r\n    } catch (err) {\r\n      console.error('[PushNotification] Failed to show notification:', err);\r\n    }\r\n  }\r\n}\r\n","import HomePage from '../pages/home/home-page';\r\nimport AboutPage from '../pages/about/about-page';\r\n// temporarily point to the repaired add-story page implementation\r\nimport AddStoryPage from '../pages/add-story/add-story-page';\r\nimport LoginPage from '../pages/login/login-page';\r\nimport RegisterPage from '../pages/register/register-page';\r\nimport NotificationSettingsPage from '../pages/notification-settings/notification-settings-page';\r\nimport OfflineDataPage from '../pages/offline-data/offline-data-page';\r\n\r\nconst routes = {\r\n  '/': new HomePage(),\r\n  '/about': new AboutPage(),\r\n  '/add': new AddStoryPage(),\r\n  '/login': new LoginPage(),\r\n  '/register': new RegisterPage(),\r\n  '/notifications': new NotificationSettingsPage(),\r\n  '/offline-data': new OfflineDataPage(),\r\n};\r\n\r\nexport default routes;\r\n\r\n","import StoryService from '../../data/api';\r\nimport IndexedDBService from '../../utils/indexeddb-service';\r\n\r\nexport default class HomePage {\r\n  #map = null;\r\n  #stories = [];\r\n  #activeMarkerId = null;\r\n  #indexedDB = new IndexedDBService();\r\n\r\n  async render() {\r\n    return `\r\n      <section class=\"container home-page\">\r\n        <div class=\"page-header\">\r\n          <div class=\"header-content\">\r\n            <h1>Story Map</h1>\r\n            <div class=\"header-status\">\r\n              <span id=\"connection-status\" class=\"connection-indicator online\" title=\"Online status\"></span>\r\n              <button id=\"logout-button\" class=\"logout-button\">Logout</button>\r\n            </div>\r\n          </div>\r\n          <button id=\"add-story-button\" class=\"add-story-button\">Add New Story</button>\r\n        </div>\r\n        <div class=\"content-wrapper\">\r\n          <div class=\"story-list\" id=\"story-list\">\r\n            <h2>Stories</h2>\r\n            <div class=\"stories-container\">Loading stories...</div>\r\n          </div>\r\n          <div class=\"map-container\">\r\n            <div id=\"map\"></div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    // Check authentication\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      window.location.hash = '#/login';\r\n      return;\r\n    }\r\n\r\n    // Initialize IndexedDB\r\n    try {\r\n      await this.#indexedDB.init();\r\n    } catch (err) {\r\n      console.error('[HomePage] Error initializing IndexedDB:', err);\r\n    }\r\n\r\n    // Update connection status\r\n    this._updateConnectionStatus();\r\n    window.addEventListener('online', () => this._updateConnectionStatus());\r\n    window.addEventListener('offline', () => this._updateConnectionStatus());\r\n\r\n    // Setup logout button\r\n    const logoutButton = document.getElementById('logout-button');\r\n    logoutButton.addEventListener('click', () => {\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('userId');\r\n      localStorage.removeItem('name');\r\n      window.location.hash = '#/login';\r\n    });\r\n\r\n    // Setup add story button\r\n    const addStoryButton = document.getElementById('add-story-button');\r\n    addStoryButton.addEventListener('click', () => {\r\n      window.location.hash = '#/add';\r\n    });\r\n\r\n    await this._initializeMap();\r\n    await this._loadStories();\r\n  }\r\n\r\n  async _initializeMap() {\r\n    const { default: mapService } = await import('../../utils/map-service');\r\n    this.#map = mapService.initializeMap('map');\r\n  }\r\n\r\n  async _loadStories() {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const isOnline = navigator.onLine;\r\n\r\n      let stories = [];\r\n\r\n      if (isOnline) {\r\n        // Fetch from API\r\n        try {\r\n          stories = await StoryService.getAllStories(token);\r\n          this.#stories = stories;\r\n\r\n          // Save to IndexedDB for offline access\r\n          for (const story of stories) {\r\n            await this.#indexedDB.addStory(story);\r\n          }\r\n        } catch (error) {\r\n          console.error('[HomePage] Error fetching from API:', error);\r\n          // Fall back to IndexedDB\r\n          stories = await this.#indexedDB.getAllStories();\r\n        }\r\n      } else {\r\n        // Load from IndexedDB when offline\r\n        console.log('[HomePage] Offline: Loading from IndexedDB');\r\n        stories = await this.#indexedDB.getAllStories();\r\n      }\r\n\r\n      this.#stories = stories;\r\n      this._renderStories(stories);\r\n      this._renderMarkers(stories);\r\n    } catch (error) {\r\n      console.error('[HomePage] Error loading stories:', error);\r\n      document.querySelector('.stories-container').innerHTML = '<p>Error loading stories. Please try again later.</p>';\r\n    }\r\n  }\r\n\r\n  _renderStories(stories) {\r\n    const storiesContainer = document.querySelector('.stories-container');\r\n    if (!stories.length) {\r\n      storiesContainer.innerHTML = '<p>No stories found.</p>';\r\n      return;\r\n    }\r\n\r\n    const storiesHtml = stories.map((story) => {\r\n      const createdDate = new Date(story.createdAt).toLocaleDateString('en-US', {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric'\r\n      });\r\n\r\n      return `\r\n        <article class=\"story-item ${story.id === this.#activeMarkerId ? 'active' : ''}\" data-id=\"${story.id}\">\r\n          <img src=\"${story.photoUrl}\" alt=\"Photo from ${story.name}\" class=\"story-image\">\r\n          <div class=\"story-content\">\r\n            <h3>${story.name}</h3>\r\n            <p class=\"story-description\">${story.description}</p>\r\n            <time class=\"story-date\">${createdDate}</time>\r\n          </div>\r\n        </article>\r\n      `;\r\n    }).join('');\r\n\r\n    storiesContainer.innerHTML = storiesHtml;\r\n\r\n    // Add click event listeners to story items\r\n    document.querySelectorAll('.story-item').forEach((item) => {\r\n      item.addEventListener('click', () => {\r\n        const storyId = item.dataset.id;\r\n        const story = this.#stories.find((s) => s.id === storyId);\r\n        if (story && story.lat && story.lon) {\r\n          const { default: mapService } = require('../../utils/map-service');\r\n          mapService.setView(story.lat, story.lon, 15);\r\n          this.#activeMarkerId = storyId;\r\n          this._highlightActiveStory(storyId);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  _renderMarkers(stories) {\r\n    const { default: mapService } = require('../../utils/map-service');\r\n    mapService.clearMarkers();\r\n\r\n    const bounds = L.latLngBounds();\r\n    let hasValidCoordinates = false;\r\n\r\n    stories.forEach((story) => {\r\n      if (story.lat && story.lon) {\r\n        hasValidCoordinates = true;\r\n        \r\n        const createdDate = new Date(story.createdAt).toLocaleDateString('en-US', {\r\n          year: 'numeric',\r\n          month: 'short',\r\n          day: 'numeric'\r\n        });\r\n\r\n        const marker = mapService.addMarker(story.lat, story.lon, {\r\n          title: story.name,\r\n        });\r\n\r\n        marker.bindPopup(`\r\n          <div class=\"marker-popup\">\r\n            <img src=\"${story.photoUrl}\" alt=\"Photo from ${story.name}\" class=\"popup-image\">\r\n            <h3>${story.name}</h3>\r\n            <p>${story.description}</p>\r\n            <time class=\"popup-date\">${createdDate}</time>\r\n          </div>\r\n        `);\r\n\r\n        marker.on('click', () => {\r\n          this.#activeMarkerId = story.id;\r\n          this._highlightActiveStory(story.id);\r\n        });\r\n\r\n        bounds.extend([story.lat, story.lon]);\r\n      }\r\n    });\r\n\r\n    if (hasValidCoordinates) {\r\n      mapService.getMap().fitBounds(bounds, {\r\n        padding: [50, 50],\r\n      });\r\n    }\r\n  }\r\n\r\n  _highlightActiveStory(storyId) {\r\n    document.querySelectorAll('.story-item').forEach((item) => {\r\n      item.classList.toggle('active', item.dataset.id === storyId);\r\n    });\r\n  }\r\n\r\n  _updateConnectionStatus() {\r\n    const statusEl = document.getElementById('connection-status');\r\n    if (!statusEl) return;\r\n\r\n    if (navigator.onLine) {\r\n      statusEl.classList.remove('offline');\r\n      statusEl.classList.add('online');\r\n      statusEl.title = 'Online';\r\n      statusEl.setAttribute('aria-label', 'Connection status: Online');\r\n    } else {\r\n      statusEl.classList.remove('online');\r\n      statusEl.classList.add('offline');\r\n      statusEl.title = 'Offline';\r\n      statusEl.setAttribute('aria-label', 'Connection status: Offline');\r\n    }\r\n  }\r\n\r\n  _renderStories(stories) {\r\n    const storiesContainer = document.querySelector('.stories-container');\r\n    if (!stories.length) {\r\n      storiesContainer.innerHTML = '<p>No stories found.</p>';\r\n      return;\r\n    }\r\n\r\n    const storiesHtml = stories.map((story) => {\r\n      const createdDate = new Date(story.createdAt).toLocaleDateString('en-US', {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric'\r\n      });\r\n\r\n      return `\r\n        <article class=\"story-item ${story.id === this.#activeMarkerId ? 'active' : ''}\" data-id=\"${story.id}\">\r\n          <img src=\"${story.photoUrl}\" alt=\"Photo from ${story.name}\" class=\"story-image\">\r\n          <div class=\"story-content\">\r\n            <h3>${story.name}</h3>\r\n            <p class=\"story-description\">${story.description}</p>\r\n            <time class=\"story-date\">${createdDate}</time>\r\n          </div>\r\n        </article>\r\n      `;\r\n    }).join('');\r\n\r\n    storiesContainer.innerHTML = storiesHtml;\r\n\r\n    // Add click event listeners to story items\r\n    document.querySelectorAll('.story-item').forEach((item) => {\r\n      item.addEventListener('click', () => {\r\n        const storyId = item.dataset.id;\r\n        const story = this.#stories.find((s) => s.id === storyId);\r\n        if (story && story.lat && story.lon) {\r\n          const { default: mapService } = require('../../utils/map-service');\r\n          mapService.setView(story.lat, story.lon, 15);\r\n          this.#activeMarkerId = storyId;\r\n          this._highlightActiveStory(storyId);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  _renderMarkers(stories) {\r\n    const { default: mapService } = require('../../utils/map-service');\r\n    mapService.clearMarkers();\r\n\r\n    const bounds = L.latLngBounds();\r\n    let hasValidCoordinates = false;\r\n\r\n    stories.forEach((story) => {\r\n      if (story.lat && story.lon) {\r\n        hasValidCoordinates = true;\r\n        \r\n        const createdDate = new Date(story.createdAt).toLocaleDateString('en-US', {\r\n          year: 'numeric',\r\n          month: 'short',\r\n          day: 'numeric'\r\n        });\r\n\r\n        const marker = mapService.addMarker(story.lat, story.lon, {\r\n          title: story.name,\r\n        });\r\n\r\n        marker.bindPopup(`\r\n          <div class=\"marker-popup\">\r\n            <img src=\"${story.photoUrl}\" alt=\"Photo from ${story.name}\" class=\"popup-image\">\r\n            <h3>${story.name}</h3>\r\n            <p>${story.description}</p>\r\n            <time class=\"popup-date\">${createdDate}</time>\r\n          </div>\r\n        `);\r\n\r\n        marker.on('click', () => {\r\n          this.#activeMarkerId = story.id;\r\n          this._highlightActiveStory(story.id);\r\n        });\r\n\r\n        bounds.extend([story.lat, story.lon]);\r\n      }\r\n    });\r\n\r\n    if (hasValidCoordinates) {\r\n      mapService.getMap().fitBounds(bounds, {\r\n        padding: [50, 50],\r\n      });\r\n    }\r\n  }\r\n\r\n  _highlightActiveStory(storyId) {\r\n    document.querySelectorAll('.story-item').forEach((item) => {\r\n      item.classList.toggle('active', item.dataset.id === storyId);\r\n    });\r\n  }\r\n}\r\n","export default class AboutPage {\r\n  async render() {\r\n    return `\r\n      <section class=\"container\">\r\n        <h1>About Page</h1>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    // Do your job here\r\n  }\r\n}\r\n","import StoryService from '../../data/api';\r\nimport mapService from '../../utils/map-service';\r\nimport IndexedDBService from '../../utils/indexeddb-service';\r\n\r\nexport default class AddStoryPage {\r\n  constructor() {\r\n    this.selectedLocation = null;\r\n    this.map = null;\r\n    this.locationMarker = null;\r\n    this.indexedDB = new IndexedDBService();\r\n  }\r\n\r\n  async render() {\r\n    return `\r\n      <section class=\"container add-story-page\">\r\n        <h1>Add New Story</h1>\r\n        <div id=\"offline-notice\" class=\"offline-notice\" style=\"display: none;\">\r\n           You are offline. Your story will be saved locally and synced when you're back online.\r\n        </div>\r\n        <form id=\"add-story-form\" class=\"add-story-form\">\r\n          <div class=\"form-group\">\r\n            <label for=\"description\">Story Description</label>\r\n            <textarea id=\"description\" name=\"description\" required placeholder=\"Tell your story...\" aria-required=\"true\"></textarea>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label for=\"photo\">Photo</label>\r\n            <div class=\"photo-input-container\">\r\n              <input type=\"file\" id=\"photo\" name=\"photo\" accept=\"image/*\" required aria-required=\"true\">\r\n              <button type=\"button\" id=\"camera-button\" class=\"camera-button\">Take Photo</button>\r\n            </div>\r\n            <div id=\"photo-preview\" class=\"photo-preview\"></div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label>Location</label>\r\n            <div id=\"location-map\" class=\"location-map\"></div>\r\n            <p class=\"location-help\">Click on the map to select a location for your story</p>\r\n          </div>\r\n\r\n          <div class=\"form-actions\">\r\n            <button type=\"button\" id=\"cancel-button\" class=\"cancel-button\">Cancel</button>\r\n            <button type=\"submit\" class=\"submit-button\">Share Story</button>\r\n          </div>\r\n        </form>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      window.location.hash = '#/login';\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this.indexedDB.init();\r\n    } catch (err) {\r\n      console.error('[AddStoryPage] IndexedDB init error', err);\r\n    }\r\n\r\n    this.updateOfflineNotice();\r\n    window.addEventListener('online', () => this.updateOfflineNotice());\r\n    window.addEventListener('offline', () => this.updateOfflineNotice());\r\n\r\n    this.initMap();\r\n    this.initForm();\r\n    this.initCamera();\r\n  }\r\n\r\n  updateOfflineNotice() {\r\n    const notice = document.getElementById('offline-notice');\r\n    if (!notice) return;\r\n    notice.style.display = navigator.onLine ? 'none' : 'block';\r\n  }\r\n\r\n  initMap() {\r\n    this.map = mapService.initializeMap('location-map', { zoom: 5 });\r\n    this.map.on('click', (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      this.selectedLocation = { lat, lng };\r\n      if (this.locationMarker) mapService.removeMarker(this.locationMarker);\r\n      this.locationMarker = mapService.addMarker(lat, lng, { draggable: true });\r\n      this.locationMarker.on('dragend', (ev) => {\r\n        const pos = ev.target.getLatLng();\r\n        this.selectedLocation = { lat: pos.lat, lng: pos.lng };\r\n      });\r\n    });\r\n  }\r\n\r\n  initForm() {\r\n    const form = document.getElementById('add-story-form');\r\n    const photoInput = document.getElementById('photo');\r\n    const preview = document.getElementById('photo-preview');\r\n    const cancelBtn = document.getElementById('cancel-button');\r\n\r\n    if (cancelBtn) cancelBtn.addEventListener('click', () => { window.location.hash = '#/'; });\r\n\r\n    if (photoInput) {\r\n      photoInput.addEventListener('change', (e) => {\r\n        const file = e.target.files && e.target.files[0];\r\n        if (!file || !preview) return;\r\n        const r = new FileReader();\r\n        r.onload = (ev) => { preview.innerHTML = `<img src=\"${ev.target.result}\" class=\"preview-image\" alt=\"Preview\">`; };\r\n        r.readAsDataURL(file);\r\n      });\r\n    }\r\n\r\n    if (form) {\r\n      form.addEventListener('submit', async (evt) => {\r\n        evt.preventDefault();\r\n        const formData = new FormData(form);\r\n        const description = formData.get('description');\r\n        const photoFile = formData.get('photo');\r\n\r\n        if (!this.selectedLocation) { alert('Please select a location on the map'); return; }\r\n        const token = localStorage.getItem('token');\r\n        if (!token) { window.location.hash = '#/login'; return; }\r\n\r\n        if (navigator.onLine) {\r\n          try {\r\n            await StoryService.addStory(token, { description, photo: photoFile, lat: this.selectedLocation.lat, lon: this.selectedLocation.lng });\r\n            alert('Story shared successfully!');\r\n            window.location.hash = '#/';\r\n          } catch (err) {\r\n            console.error('Add story failed, saving offline', err);\r\n            await this.saveStoryOffline(description, photoFile);\r\n          }\r\n        } else {\r\n          await this.saveStoryOffline(description, photoFile);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  async saveStoryOffline(description, photoFile) {\r\n    if (!photoFile) {\r\n      alert('Please attach a photo');\r\n      return;\r\n    }\r\n    const reader = new FileReader();\r\n    reader.onload = async (e) => {\r\n      const photoData = e.target.result;\r\n      const pending = { description, photoData, lat: this.selectedLocation.lat, lon: this.selectedLocation.lng, timestamp: Date.now() };\r\n      await this.indexedDB.addPendingStory(pending);\r\n      alert('Saved locally. It will sync when you are back online.');\r\n      window.location.hash = '#/';\r\n    };\r\n    reader.readAsDataURL(photoFile);\r\n  }\r\n\r\n  initCamera() {\r\n    const cameraBtn = document.getElementById('camera-button');\r\n    const preview = document.getElementById('photo-preview');\r\n    const photoInput = document.getElementById('photo');\r\n    if (!cameraBtn) return;\r\n    cameraBtn.addEventListener('click', async () => {\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n        if (preview) preview.innerHTML = `<video autoplay class=\"camera-preview\"></video><button type=\"button\" class=\"capture-button\">Take Photo</button>`;\r\n        const video = document.querySelector('.camera-preview');\r\n        if (!video) return;\r\n        video.srcObject = stream;\r\n        const capture = document.querySelector('.capture-button');\r\n        if (!capture) return;\r\n        capture.addEventListener('click', () => {\r\n          const canvas = document.createElement('canvas');\r\n          canvas.width = video.videoWidth; canvas.height = video.videoHeight;\r\n          canvas.getContext('2d').drawImage(video, 0, 0);\r\n          canvas.toBlob((blob) => {\r\n            const file = new File([blob], 'camera.jpg', { type: 'image/jpeg' });\r\n            const dt = new DataTransfer(); dt.items.add(file); if (photoInput) photoInput.files = dt.files;\r\n            if (preview) preview.innerHTML = `<img src=\"${canvas.toDataURL()}\" class=\"preview-image\" alt=\"Preview\">`;\r\n            stream.getTracks().forEach(t => t.stop());\r\n          }, 'image/jpeg');\r\n        });\r\n      } catch (err) {\r\n        console.error('Camera error', err);\r\n        alert('Cannot access camera.');\r\n      }\r\n    });\r\n  }\r\n}\r\n","import StoryService from '../../data/api';\r\n\r\nexport default class LoginPage {\r\n  async render() {\r\n    return `\r\n      <section class=\"container login-page\">\r\n        <div class=\"auth-container\">\r\n          <h1>Login</h1>\r\n          <form id=\"login-form\" class=\"auth-form\">\r\n            <div class=\"form-group\">\r\n              <label for=\"email\">Email</label>\r\n              <input \r\n                type=\"email\" \r\n                id=\"email\" \r\n                name=\"email\" \r\n                required \r\n                aria-required=\"true\"\r\n                placeholder=\"Enter your email\">\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label for=\"password\">Password</label>\r\n              <input \r\n                type=\"password\" \r\n                id=\"password\" \r\n                name=\"password\" \r\n                required \r\n                aria-required=\"true\"\r\n                placeholder=\"Enter your password\">\r\n            </div>\r\n\r\n            <div class=\"error-message\" id=\"error-message\"></div>\r\n\r\n            <button type=\"submit\" class=\"submit-button\">Login</button>\r\n          </form>\r\n\r\n          <p class=\"auth-link\">\r\n            Don't have an account? <button type=\"button\" id=\"register-link\" class=\"link-button\">Register here</button>\r\n          </p>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    const form = document.getElementById('login-form');\r\n    const errorMessage = document.getElementById('error-message');\r\n    const registerLink = document.getElementById('register-link');\r\n\r\n    // Handle register link button\r\n    registerLink.addEventListener('click', () => {\r\n      window.location.hash = '#/register';\r\n    });\r\n\r\n    form.addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      try {\r\n        const email = document.getElementById('email').value;\r\n        const password = document.getElementById('password').value;\r\n\r\n        const response = await StoryService.login(email, password);\r\n        \r\n        // Save token to localStorage\r\n        localStorage.setItem('token', response.loginResult.token);\r\n        localStorage.setItem('userId', response.loginResult.userId);\r\n        localStorage.setItem('name', response.loginResult.name);\r\n\r\n        // Redirect to home\r\n        window.location.hash = '#/';\r\n      } catch (error) {\r\n        errorMessage.textContent = error.message || 'Login failed. Please try again.';\r\n        errorMessage.style.display = 'block';\r\n      }\r\n    });\r\n  }\r\n}\r\n","import StoryService from '../../data/api';\r\n\r\nexport default class RegisterPage {\r\n  async render() {\r\n    return `\r\n      <section class=\"container register-page\">\r\n        <div class=\"auth-container\">\r\n          <h1>Register</h1>\r\n          <form id=\"register-form\" class=\"auth-form\">\r\n            <div class=\"form-group\">\r\n              <label for=\"name\">Full Name</label>\r\n              <input \r\n                type=\"text\" \r\n                id=\"name\" \r\n                name=\"name\" \r\n                required \r\n                aria-required=\"true\"\r\n                placeholder=\"Enter your full name\">\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label for=\"email\">Email</label>\r\n              <input \r\n                type=\"email\" \r\n                id=\"email\" \r\n                name=\"email\" \r\n                required \r\n                aria-required=\"true\"\r\n                placeholder=\"Enter your email\">\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label for=\"password\">Password</label>\r\n              <input \r\n                type=\"password\" \r\n                id=\"password\" \r\n                name=\"password\" \r\n                required \r\n                aria-required=\"true\"\r\n                placeholder=\"Enter your password (min. 6 characters)\"\r\n                minlength=\"6\">\r\n            </div>\r\n\r\n            <div class=\"error-message\" id=\"error-message\"></div>\r\n\r\n            <button type=\"submit\" class=\"submit-button\">Register</button>\r\n          </form>\r\n\r\n          <p class=\"auth-link\">\r\n            Already have an account? <button type=\"button\" id=\"login-link\" class=\"link-button\">Login here</button>\r\n          </p>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    const form = document.getElementById('register-form');\r\n    const errorMessage = document.getElementById('error-message');\r\n    const loginLink = document.getElementById('login-link');\r\n\r\n    // Handle login link button\r\n    loginLink.addEventListener('click', () => {\r\n      window.location.hash = '#/login';\r\n    });\r\n\r\n    form.addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      try {\r\n        const name = document.getElementById('name').value;\r\n        const email = document.getElementById('email').value;\r\n        const password = document.getElementById('password').value;\r\n\r\n        await StoryService.register(name, email, password);\r\n\r\n        // Redirect to login\r\n        alert('Registration successful! Please login.');\r\n        window.location.hash = '#/login';\r\n      } catch (error) {\r\n        errorMessage.textContent = error.message || 'Registration failed. Please try again.';\r\n        errorMessage.style.display = 'block';\r\n      }\r\n    });\r\n  }\r\n}\r\n","import PushNotificationService from '../../utils/push-notification-service';\r\nimport IndexedDBService from '../../utils/indexeddb-service';\r\n\r\nexport default class NotificationSettingsPage {\r\n  constructor() {\r\n    this.pushService = new PushNotificationService();\r\n    this.indexedDB = new IndexedDBService();\r\n  }\r\n\r\n  async render() {\r\n    return `\r\n      <section class=\"container notification-settings-page\">\r\n        <div class=\"settings-container\">\r\n          <h1>Notification Settings</h1>\r\n          \r\n          <div class=\"settings-card\">\r\n            <h2>Push Notifications</h2>\r\n            <p class=\"setting-description\">Receive real-time notifications about new stories and updates.</p>\r\n            \r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-label\">\r\n                <h3>Enable Push Notifications</h3>\r\n                <p class=\"setting-info\" id=\"permission-status\">Checking permission status...</p>\r\n              </div>\r\n              <button \r\n                id=\"toggle-notification-btn\" \r\n                class=\"toggle-button\" \r\n                aria-label=\"Toggle push notifications\">\r\n                <span class=\"toggle-switch\"></span>\r\n              </button>\r\n            </div>\r\n\r\n            <div class=\"setting-actions\">\r\n              <button id=\"test-notification-btn\" class=\"action-button\" disabled>\r\n                 Send Test Notification\r\n              </button>\r\n              <button id=\"refresh-status-btn\" class=\"action-button secondary\">\r\n                 Refresh Status\r\n              </button>\r\n            </div>\r\n\r\n            <div class=\"notification-info\">\r\n              <p><strong>Status:</strong> <span id=\"notification-status\">Loading...</span></p>\r\n              <p><strong>Permission:</strong> <span id=\"notification-permission\">Loading...</span></p>\r\n              <div id=\"subscription-info\" class=\"subscription-details\" style=\"display: none;\">\r\n                <p><strong>Subscription Status:</strong> <span id=\"subscription-status\">Active</span></p>\r\n                <p class=\"small-text\">You will receive push notifications about new stories.</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"settings-card faq-section\">\r\n            <h2>FAQ</h2>\r\n            <details>\r\n              <summary>What are push notifications?</summary>\r\n              <p>Push notifications are messages sent to your device from the Story Map server. You'll receive alerts about new stories shared by other users.</p>\r\n            </details>\r\n            <details>\r\n              <summary>How do I enable notifications?</summary>\r\n              <p>Click the \"Enable Push Notifications\" toggle button above. Your browser will ask for permission to send notifications.</p>\r\n            </details>\r\n            <details>\r\n              <summary>Can I disable notifications anytime?</summary>\r\n              <p>Yes! Just click the toggle button to disable notifications. You can re-enable them anytime.</p>\r\n            </details>\r\n            <details>\r\n              <summary>Will my data be safe?</summary>\r\n              <p>Your subscription data is encrypted and stored securely. We only use it to send you notifications about new stories.</p>\r\n            </details>\r\n          </div>\r\n\r\n          <div class=\"back-button-container\">\r\n            <button id=\"back-to-home-btn\" class=\"back-button\"> Back to Home</button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    await this.indexedDB.init();\r\n    \r\n    const toggleBtn = document.getElementById('toggle-notification-btn');\r\n    const testBtn = document.getElementById('test-notification-btn');\r\n    const refreshBtn = document.getElementById('refresh-status-btn');\r\n    const backBtn = document.getElementById('back-to-home-btn');\r\n\r\n    // Initialize push service\r\n    const initialized = await this.pushService.init();\r\n    \r\n    if (!initialized) {\r\n      this.updateStatus('error', 'Push notifications are not supported on this browser');\r\n      toggleBtn.disabled = true;\r\n      return;\r\n    }\r\n\r\n    // Update status on load\r\n    await this.updateNotificationStatus();\r\n\r\n    // Toggle subscription\r\n    toggleBtn.addEventListener('click', async () => {\r\n      await this.toggleSubscription();\r\n    });\r\n\r\n    // Test notification\r\n    testBtn.addEventListener('click', async () => {\r\n      await this.sendTestNotification();\r\n    });\r\n\r\n    // Refresh status\r\n    refreshBtn.addEventListener('click', async () => {\r\n      await this.updateNotificationStatus();\r\n    });\r\n\r\n    // Back button\r\n    backBtn.addEventListener('click', () => {\r\n      window.location.hash = '#/';\r\n    });\r\n  }\r\n\r\n  async updateNotificationStatus() {\r\n    const statusEl = document.getElementById('notification-status');\r\n    const permissionEl = document.getElementById('notification-permission');\r\n    const toggleBtn = document.getElementById('toggle-notification-btn');\r\n    const testBtn = document.getElementById('test-notification-btn');\r\n    const subscriptionInfoEl = document.getElementById('subscription-info');\r\n\r\n    try {\r\n      const isSubscribed = await this.pushService.isSubscribed();\r\n      const permission = Notification.permission;\r\n\r\n      // Update UI\r\n      statusEl.textContent = isSubscribed ? ' Enabled' : ' Disabled';\r\n      permissionEl.textContent = this.formatPermission(permission);\r\n\r\n      if (isSubscribed) {\r\n        toggleBtn.classList.add('active');\r\n        testBtn.disabled = false;\r\n        subscriptionInfoEl.style.display = 'block';\r\n      } else {\r\n        toggleBtn.classList.remove('active');\r\n        testBtn.disabled = true;\r\n        subscriptionInfoEl.style.display = 'none';\r\n      }\r\n\r\n      const statusEl2 = document.getElementById('permission-status');\r\n      if (permission === 'granted' && isSubscribed) {\r\n        statusEl2.textContent = ' Notifications are enabled';\r\n        statusEl2.style.color = '#28a745';\r\n      } else if (permission === 'denied') {\r\n        statusEl2.textContent = ' You have denied notifications. Enable them in browser settings.';\r\n        statusEl2.style.color = '#dc3545';\r\n        toggleBtn.disabled = true;\r\n      } else if (permission === 'default') {\r\n        statusEl2.textContent = ' Click toggle to enable notifications';\r\n        statusEl2.style.color = '#ffc107';\r\n      }\r\n    } catch (err) {\r\n      console.error('[NotificationSettings] Error updating status:', err);\r\n      statusEl.textContent = 'Error';\r\n      statusEl.style.color = '#dc3545';\r\n    }\r\n  }\r\n\r\n  async toggleSubscription() {\r\n    const toggleBtn = document.getElementById('toggle-notification-btn');\r\n    toggleBtn.disabled = true;\r\n\r\n    try {\r\n      const isSubscribed = await this.pushService.isSubscribed();\r\n\r\n      if (isSubscribed) {\r\n        // Unsubscribe\r\n        const success = await this.pushService.unsubscribe();\r\n        if (success) {\r\n          await this.indexedDB.deletePushSubscription();\r\n          alert('Push notifications have been disabled');\r\n        }\r\n      } else {\r\n        // Request permission first\r\n        const hasPermission = await this.pushService.requestPermission();\r\n        if (!hasPermission) {\r\n          alert('Permission denied. Please enable notifications in your browser settings.');\r\n          toggleBtn.disabled = false;\r\n          return;\r\n        }\r\n\r\n        // Subscribe with VAPID public key\r\n        // Note: Replace with actual VAPID public key from your server\r\n        const VAPID_PUBLIC_KEY = 'BEl62iUEL8kIAcD78j6O7u0zkz7HLEcqU8MKS0Ny2m89KBj1t_ULhfYoxKiVv0vJi0lxPKKWLXu5b3vZHgUzN7I';\r\n\r\n        const subscription = await this.pushService.subscribe(VAPID_PUBLIC_KEY);\r\n        if (subscription) {\r\n          // Save to IndexedDB\r\n          await this.indexedDB.savePushSubscription(subscription);\r\n\r\n          // Send to server\r\n          const token = localStorage.getItem('token');\r\n          if (token) {\r\n            try {\r\n              await this.pushService.sendSubscriptionToServer(subscription, token);\r\n            } catch (err) {\r\n              console.warn('[NotificationSettings] Could not send subscription to server:', err);\r\n              // Still show success as subscription is saved locally\r\n            }\r\n          }\r\n\r\n          alert('Push notifications have been enabled!');\r\n        } else {\r\n          alert('Failed to enable notifications. Please try again.');\r\n        }\r\n      }\r\n\r\n      await this.updateNotificationStatus();\r\n    } catch (err) {\r\n      console.error('[NotificationSettings] Error toggling subscription:', err);\r\n      alert('Error: ' + err.message);\r\n    } finally {\r\n      toggleBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  async sendTestNotification() {\r\n    try {\r\n      const testBtn = document.getElementById('test-notification-btn');\r\n      testBtn.disabled = true;\r\n\r\n      await this.pushService.showLocalNotification('Test Notification', {\r\n        body: ' Push notifications are working! You will receive notifications about new stories.',\r\n        tag: 'test-notification',\r\n        requireInteraction: true,\r\n        actions: [\r\n          { action: 'view-all', title: 'View All Stories' },\r\n          { action: 'dismiss', title: 'Dismiss' },\r\n        ],\r\n      });\r\n\r\n      alert('Test notification sent!');\r\n    } catch (err) {\r\n      console.error('[NotificationSettings] Error sending test notification:', err);\r\n      alert('Error: ' + err.message);\r\n    } finally {\r\n      const testBtn = document.getElementById('test-notification-btn');\r\n      testBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  formatPermission(permission) {\r\n    switch (permission) {\r\n      case 'granted':\r\n        return ' Granted';\r\n      case 'denied':\r\n        return ' Denied';\r\n      case 'default':\r\n        return ' Not Set';\r\n      default:\r\n        return 'Unknown';\r\n    }\r\n  }\r\n\r\n  updateStatus(status, message) {\r\n    const statusEl = document.getElementById('notification-status');\r\n    if (statusEl) {\r\n      statusEl.textContent = message;\r\n      statusEl.style.color = status === 'error' ? '#dc3545' : '#28a745';\r\n    }\r\n  }\r\n}\r\n","import IndexedDBService from '../../utils/indexeddb-service';\r\nimport StoryService from '../../data/api';\r\n\r\nexport default class OfflineDataPage {\r\n  #indexedDB = new IndexedDBService();\r\n\r\n  async render() {\r\n    return `\r\n      <section class=\"container offline-data-page\">\r\n        <h1>Offline Data Manager</h1>\r\n        \r\n        <div class=\"data-sections\">\r\n          <!-- Cached Stories Section -->\r\n          <div class=\"data-section\">\r\n            <h2> Cached Stories</h2>\r\n            <p class=\"section-description\">Stories saved for offline viewing</p>\r\n            <div id=\"cached-stories-container\" class=\"data-container\">\r\n              <p class=\"loading\">Loading cached stories...</p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Pending Stories Section -->\r\n          <div class=\"data-section\">\r\n            <h2> Pending Stories</h2>\r\n            <p class=\"section-description\">Stories waiting to be synced to server</p>\r\n            <div id=\"pending-stories-container\" class=\"data-container\">\r\n              <p class=\"loading\">Loading pending stories...</p>\r\n            </div>\r\n            <button id=\"sync-pending-btn\" class=\"action-button\" style=\"margin-top: 1rem;\">\r\n               Sync Pending Stories\r\n            </button>\r\n          </div>\r\n\r\n          <!-- Search & Filter Section -->\r\n          <div class=\"data-section\">\r\n            <h2> Search Stories</h2>\r\n            <div class=\"search-container\">\r\n              <input \r\n                type=\"text\" \r\n                id=\"search-input\" \r\n                placeholder=\"Search stories by name or description...\"\r\n                class=\"search-input\"\r\n                aria-label=\"Search cached stories\">\r\n              <button id=\"search-btn\" class=\"search-button\">Search</button>\r\n              <button id=\"clear-search-btn\" class=\"search-button secondary\">Clear</button>\r\n            </div>\r\n            <div id=\"search-results-container\" class=\"data-container\" style=\"margin-top: 1rem; display: none;\">\r\n              <p class=\"loading\">Search results will appear here...</p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Database Stats Section -->\r\n          <div class=\"data-section stats-section\">\r\n            <h2> Database Statistics</h2>\r\n            <div id=\"db-stats\" class=\"stats-grid\">\r\n              <div class=\"stat-item\">\r\n                <span class=\"stat-label\">Total Stories</span>\r\n                <span class=\"stat-value\" id=\"total-stories\">0</span>\r\n              </div>\r\n              <div class=\"stat-item\">\r\n                <span class=\"stat-label\">Pending Stories</span>\r\n                <span class=\"stat-value\" id=\"pending-count\">0</span>\r\n              </div>\r\n              <div class=\"stat-item\">\r\n                <span class=\"stat-label\">Storage Status</span>\r\n                <span class=\"stat-value\" id=\"storage-status\">Active</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Actions Section -->\r\n          <div class=\"data-section actions-section\">\r\n            <h2> Database Actions</h2>\r\n            <div class=\"action-buttons\">\r\n              <button id=\"export-data-btn\" class=\"action-button\"> Export Data</button>\r\n              <button id=\"clear-cache-btn\" class=\"action-button danger\"> Clear Cache</button>\r\n              <button id=\"back-home-btn\" class=\"action-button secondary\"> Back to Home</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async afterRender() {\r\n    try {\r\n      await this.#indexedDB.init();\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error initializing IndexedDB:', err);\r\n    }\r\n\r\n    // Load data\r\n    await this.loadCachedStories();\r\n    await this.loadPendingStories();\r\n    await this.updateStats();\r\n\r\n    // Setup event listeners\r\n    document.getElementById('sync-pending-btn').addEventListener('click', () => this.syncPendingStories());\r\n    document.getElementById('search-btn').addEventListener('click', () => this.performSearch());\r\n    document.getElementById('clear-search-btn').addEventListener('click', () => this.clearSearch());\r\n    document.getElementById('export-data-btn').addEventListener('click', () => this.exportData());\r\n    document.getElementById('clear-cache-btn').addEventListener('click', () => this.clearCache());\r\n    document.getElementById('back-home-btn').addEventListener('click', () => {\r\n      window.location.hash = '#/';\r\n    });\r\n\r\n    // Allow search on Enter key\r\n    document.getElementById('search-input').addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        this.performSearch();\r\n      }\r\n    });\r\n  }\r\n\r\n  async loadCachedStories() {\r\n    try {\r\n      const stories = await this.#indexedDB.getAllStories();\r\n      const container = document.getElementById('cached-stories-container');\r\n\r\n      if (!stories || stories.length === 0) {\r\n        container.innerHTML = '<p class=\"empty-state\">No cached stories found.</p>';\r\n        return;\r\n      }\r\n\r\n      const html = stories.map(story => `\r\n        <div class=\"story-card\">\r\n          <img src=\"${story.photoUrl}\" alt=\"${story.name}\" class=\"story-thumbnail\" onerror=\"this.src='/favicon.png'\">\r\n          <div class=\"story-info\">\r\n            <h3>${story.name}</h3>\r\n            <p>${story.description}</p>\r\n            <small>Created: ${new Date(story.createdAt).toLocaleDateString()}</small>\r\n            <div class=\"story-actions\">\r\n              <button class=\"delete-btn\" onclick=\"this.closest('.offline-data-page') ? null : location.hash='#/'\">Delete</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `).join('');\r\n\r\n      container.innerHTML = html;\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error loading cached stories:', err);\r\n      document.getElementById('cached-stories-container').innerHTML = '<p class=\"error\">Error loading cached stories</p>';\r\n    }\r\n  }\r\n\r\n  async loadPendingStories() {\r\n    try {\r\n      const stories = await this.#indexedDB.getPendingStories();\r\n      const container = document.getElementById('pending-stories-container');\r\n\r\n      if (!stories || stories.length === 0) {\r\n        container.innerHTML = '<p class=\"empty-state\">No pending stories to sync.</p>';\r\n        return;\r\n      }\r\n\r\n      const html = stories.map(story => `\r\n        <div class=\"pending-card\">\r\n          <div class=\"pending-header\">\r\n            <h3>${story.description?.substring(0, 50) || 'Untitled'}...</h3>\r\n            <span class=\"status-badge\">Pending</span>\r\n          </div>\r\n          <p>Created: ${new Date(story.timestamp || Date.now()).toLocaleString()}</p>\r\n          <div class=\"pending-preview\">\r\n            ${story.photoData ? '<img src=\"' + story.photoData + '\" alt=\"preview\" class=\"photo-preview\">' : '<p>No photo</p>'}\r\n          </div>\r\n        </div>\r\n      `).join('');\r\n\r\n      container.innerHTML = html;\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error loading pending stories:', err);\r\n      document.getElementById('pending-stories-container').innerHTML = '<p class=\"error\">Error loading pending stories</p>';\r\n    }\r\n  }\r\n\r\n  async performSearch() {\r\n    const query = document.getElementById('search-input').value;\r\n    if (!query.trim()) {\r\n      this.clearSearch();\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const results = await this.#indexedDB.searchStories({ query });\r\n      const container = document.getElementById('search-results-container');\r\n      container.style.display = 'block';\r\n\r\n      if (!results || results.length === 0) {\r\n        container.innerHTML = `<p class=\"empty-state\">No stories found matching \"${query}\"</p>`;\r\n        return;\r\n      }\r\n\r\n      const html = results.map(story => `\r\n        <div class=\"story-card\">\r\n          <img src=\"${story.photoUrl}\" alt=\"${story.name}\" class=\"story-thumbnail\" onerror=\"this.src='/favicon.png'\">\r\n          <div class=\"story-info\">\r\n            <h3>${story.name}</h3>\r\n            <p>${story.description}</p>\r\n            <small>Created: ${new Date(story.createdAt).toLocaleDateString()}</small>\r\n          </div>\r\n        </div>\r\n      `).join('');\r\n\r\n      container.innerHTML = html;\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error searching stories:', err);\r\n    }\r\n  }\r\n\r\n  clearSearch() {\r\n    document.getElementById('search-input').value = '';\r\n    document.getElementById('search-results-container').style.display = 'none';\r\n    document.getElementById('search-results-container').innerHTML = '';\r\n  }\r\n\r\n  async updateStats() {\r\n    try {\r\n      const allStories = await this.#indexedDB.getAllStories();\r\n      const pendingStories = await this.#indexedDB.getPendingStories();\r\n\r\n      document.getElementById('total-stories').textContent = allStories.length;\r\n      document.getElementById('pending-count').textContent = pendingStories.length;\r\n      document.getElementById('storage-status').textContent = 'Active ';\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error updating stats:', err);\r\n    }\r\n  }\r\n\r\n  async syncPendingStories() {\r\n    const syncBtn = document.getElementById('sync-pending-btn');\r\n    const wasDisabled = syncBtn.disabled;\r\n    syncBtn.disabled = true;\r\n    syncBtn.textContent = ' Syncing...';\r\n\r\n    try {\r\n      if (!navigator.onLine) {\r\n        alert('You are offline. Please reconnect to sync pending stories.');\r\n        return;\r\n      }\r\n\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        alert('Please login to sync stories.');\r\n        window.location.hash = '#/login';\r\n        return;\r\n      }\r\n\r\n      const pendingStories = await this.#indexedDB.getPendingStories();\r\n      if (!pendingStories || pendingStories.length === 0) {\r\n        alert('No pending stories to sync.');\r\n        return;\r\n      }\r\n\r\n      let syncedCount = 0;\r\n      const errors = [];\r\n\r\n      for (const story of pendingStories) {\r\n        try {\r\n          // Send to API\r\n          await StoryService.addStory(\r\n            story.description,\r\n            story.photoData,\r\n            story.lat,\r\n            story.lon,\r\n            token\r\n          );\r\n\r\n          // Remove from pending\r\n          await this.#indexedDB.deletePendingStory(story.id);\r\n          syncedCount++;\r\n        } catch (err) {\r\n          errors.push(`Story failed: ${err.message}`);\r\n        }\r\n      }\r\n\r\n      if (syncedCount > 0) {\r\n        alert(`Successfully synced ${syncedCount} story(ies)!`);\r\n        await this.loadPendingStories();\r\n        await this.loadCachedStories();\r\n        await this.updateStats();\r\n      }\r\n\r\n      if (errors.length > 0) {\r\n        console.error('[OfflineDataPage] Sync errors:', errors);\r\n      }\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error syncing pending stories:', err);\r\n      alert('Error syncing stories: ' + err.message);\r\n    } finally {\r\n      syncBtn.disabled = wasDisabled;\r\n      syncBtn.textContent = ' Sync Pending Stories';\r\n    }\r\n  }\r\n\r\n  async exportData() {\r\n    try {\r\n      const allStories = await this.#indexedDB.getAllStories();\r\n      const pendingStories = await this.#indexedDB.getPendingStories();\r\n\r\n      const exportData = {\r\n        exportedAt: new Date().toISOString(),\r\n        cachedStories: allStories,\r\n        pendingStories: pendingStories,\r\n      };\r\n\r\n      const dataStr = JSON.stringify(exportData, null, 2);\r\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n      const url = URL.createObjectURL(dataBlob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = `story-map-export-${Date.now()}.json`;\r\n      link.click();\r\n      URL.revokeObjectURL(url);\r\n\r\n      alert('Data exported successfully!');\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error exporting data:', err);\r\n      alert('Error exporting data: ' + err.message);\r\n    }\r\n  }\r\n\r\n  async clearCache() {\r\n    if (!confirm('Are you sure you want to clear all cached data? This action cannot be undone.')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this.#indexedDB.clearStories();\r\n      alert('Cache cleared successfully!');\r\n      await this.loadCachedStories();\r\n      await this.updateStats();\r\n    } catch (err) {\r\n      console.error('[OfflineDataPage] Error clearing cache:', err);\r\n      alert('Error clearing cache: ' + err.message);\r\n    }\r\n  }\r\n}\r\n","function extractPathnameSegments(path) {\r\n  const splitUrl = path.split('/');\r\n\r\n  return {\r\n    resource: splitUrl[1] || null,\r\n    id: splitUrl[2] || null,\r\n  };\r\n}\r\n\r\nfunction constructRouteFromSegments(pathSegments) {\r\n  let pathname = '';\r\n\r\n  if (pathSegments.resource) {\r\n    pathname = pathname.concat(`/${pathSegments.resource}`);\r\n  }\r\n\r\n  if (pathSegments.id) {\r\n    pathname = pathname.concat('/:id');\r\n  }\r\n\r\n  return pathname || '/';\r\n}\r\n\r\nexport function getActivePathname() {\r\n  return location.hash.replace('#', '') || '/';\r\n}\r\n\r\nexport function getActiveRoute() {\r\n  const pathname = getActivePathname();\r\n  const urlSegments = extractPathnameSegments(pathname);\r\n  return constructRouteFromSegments(urlSegments);\r\n}\r\n\r\nexport function parseActivePathname() {\r\n  const pathname = getActivePathname();\r\n  return extractPathnameSegments(pathname);\r\n}\r\n\r\nexport function getRoute(pathname) {\r\n  const urlSegments = extractPathnameSegments(pathname);\r\n  return constructRouteFromSegments(urlSegments);\r\n}\r\n\r\nexport function parsePathname(pathname) {\r\n  return extractPathnameSegments(pathname);\r\n}\r\n","import routes from '../routes/routes';\r\nimport { getActiveRoute } from '../routes/url-parser';\r\n\r\nclass App {\r\n  #content = null;\r\n  #drawerButton = null;\r\n  #navigationDrawer = null;\r\n\r\n  constructor({ navigationDrawer, drawerButton, content }) {\r\n    this.#content = content;\r\n    this.#drawerButton = drawerButton;\r\n    this.#navigationDrawer = navigationDrawer;\r\n\r\n    this._setupDrawer();\r\n  }\r\n\r\n  _setupDrawer() {\r\n    this.#drawerButton.addEventListener('click', () => {\r\n      const isOpen = this.#navigationDrawer.classList.toggle('open');\r\n      this.#drawerButton.setAttribute('aria-expanded', isOpen.toString());\r\n    });\r\n\r\n    // Handle Escape key to close drawer\r\n    document.addEventListener('keydown', (event) => {\r\n      if (event.key === 'Escape' && this.#navigationDrawer.classList.contains('open')) {\r\n        this.#navigationDrawer.classList.remove('open');\r\n        this.#drawerButton.setAttribute('aria-expanded', 'false');\r\n      }\r\n    });\r\n\r\n    document.body.addEventListener('click', (event) => {\r\n      if (!this.#navigationDrawer.contains(event.target) && !this.#drawerButton.contains(event.target)) {\r\n        this.#navigationDrawer.classList.remove('open');\r\n        this.#drawerButton.setAttribute('aria-expanded', 'false');\r\n      }\r\n\r\n      this.#navigationDrawer.querySelectorAll('a').forEach((link) => {\r\n        if (link.contains(event.target)) {\r\n          this.#navigationDrawer.classList.remove('open');\r\n          this.#drawerButton.setAttribute('aria-expanded', 'false');\r\n        }\r\n      })\r\n    });\r\n\r\n    // Add keyboard support for all buttons\r\n    this._setupKeyboardNavigation();\r\n  }\r\n\r\n  _setupKeyboardNavigation() {\r\n    document.addEventListener('keydown', (event) => {\r\n      // Handle button activation with Enter and Space keys\r\n      if (event.key === 'Enter' || event.key === ' ') {\r\n        if (event.target.tagName === 'BUTTON' || event.target.tagName === 'A') {\r\n          event.preventDefault();\r\n          event.target.click();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  async renderPage() {\r\n    const url = getActiveRoute();\r\n    let page = routes[url];\r\n\r\n    // If route not found, redirect to login\r\n    if (!page) {\r\n      window.location.hash = '#/login';\r\n      return;\r\n    }\r\n\r\n    // Use View Transition API if available\r\n    if (document.startViewTransition) {\r\n      document.startViewTransition(async () => {\r\n        // Update content\r\n        this.#content.innerHTML = await page.render();\r\n        \r\n        // Execute page logic\r\n        await page.afterRender();\r\n      });\r\n    } else {\r\n      // Fallback for browsers that don't support View Transition API\r\n      // Add exit animation\r\n      this.#content.classList.add('page-exit');\r\n      await new Promise(resolve => setTimeout(resolve, 300)); // Wait for exit animation\r\n\r\n      // Update content\r\n      this.#content.innerHTML = await page.render();\r\n      \r\n      // Reset animation classes\r\n      this.#content.classList.remove('page-exit');\r\n      this.#content.classList.add('page-enter');\r\n      \r\n      // Execute page logic\r\n      await page.afterRender();\r\n\r\n      // Remove enter class after animation completes\r\n      setTimeout(() => {\r\n        this.#content.classList.remove('page-enter');\r\n      }, 300);\r\n    }\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// CSS imports\r\nimport '../styles/styles.css';\r\n\r\nimport App from './pages/app';\r\nimport PushNotificationService from './utils/push-notification-service';\r\nimport IndexedDBService from './utils/indexeddb-service';\r\n\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n  // Initialize IndexedDB\r\n  const indexedDB = new IndexedDBService();\r\n  try {\r\n    await indexedDB.init();\r\n    console.log('[App] IndexedDB initialized');\r\n  } catch (err) {\r\n    console.error('[App] Failed to initialize IndexedDB:', err);\r\n  }\r\n\r\n  // Initialize Push Notification Service\r\n  const pushService = new PushNotificationService();\r\n  try {\r\n    const initialized = await pushService.init();\r\n    if (initialized) {\r\n      console.log('[App] Push notification service initialized');\r\n    }\r\n  } catch (err) {\r\n    console.error('[App] Failed to initialize push notifications:', err);\r\n  }\r\n\r\n  // Initialize app\r\n  const app = new App({\r\n    content: document.querySelector('#main-content'),\r\n    drawerButton: document.querySelector('#drawer-button'),\r\n    navigationDrawer: document.querySelector('#navigation-drawer'),\r\n  });\r\n  await app.renderPage();\r\n\r\n  window.addEventListener('hashchange', async () => {\r\n    await app.renderPage();\r\n  });\r\n\r\n  // Handle online/offline status\r\n  window.addEventListener('online', () => {\r\n    console.log('[App] Online');\r\n    // Trigger sync of pending stories\r\n  });\r\n\r\n  window.addEventListener('offline', () => {\r\n    console.log('[App] Offline');\r\n  });\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t792: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkapp_starter_project_with_webpack\"] = self[\"webpackChunkapp_starter_project_with_webpack\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [96], () => (__webpack_require__(551)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","constructor","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","initializeMap","containerId","options","center","this","zoom","setView","attribution","addTo","baseMaps","layers","addMarker","lat","lng","marker","push","removeMarker","index","indexOf","splice","removeLayer","clearMarkers","forEach","on","event","callback","getMap","BASE_URL","register","name","email","password","response","fetch","method","headers","body","JSON","stringify","responseJson","json","ok","Error","message","login","getAllStories","token","Authorization","listStory","addStory","description","photo","lon","formData","FormData","append","toString","IndexedDBService","dbName","version","db","init","Promise","resolve","reject","request","indexedDB","open","onerror","console","error","onsuccess","result","log","onupgradeneeded","target","objectStoreNames","contains","storyStore","createObjectStore","keyPath","createIndex","unique","autoIncrement","story","transaction","objectStore","put","id","getAll","getStory","get","deleteStory","delete","clearStories","clear","searchStories","filters","filter","query","toLowerCase","matchesName","includes","matchesDescription","addPendingStory","add","getPendingStories","deletePendingStory","savePushSubscription","subscription","key","data","timestamp","Date","getTime","getPushSubscription","deletePushSubscription","cacheData","url","getCachedData","close","PushNotificationService","serviceWorkerReady","subscribed","navigator","warn","window","registration","serviceWorker","scope","pushManager","getSubscription","err","requestPermission","Notification","permission","subscribe","vapidPublicKey","ready","userVisibleOnly","applicationServerKey","urlBase64ToUint8Array","unsubscribe","isSubscribed","base64String","base64","repeat","length","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","sendSubscriptionToServer","statusText","showLocalNotification","title","showNotification","icon","badge","tag","requireInteraction","render","afterRender","localStorage","getItem","location","hash","_updateConnectionStatus","addEventListener","document","getElementById","removeItem","_initializeMap","_loadStories","default","mapService","isOnline","onLine","stories","_renderStories","_renderMarkers","querySelector","innerHTML","storiesContainer","storiesHtml","map","createdDate","createdAt","toLocaleDateString","year","month","day","photoUrl","join","querySelectorAll","item","storyId","dataset","find","s","_highlightActiveStory","bounds","L","latLngBounds","hasValidCoordinates","bindPopup","extend","fitBounds","padding","classList","toggle","statusEl","remove","setAttribute","selectedLocation","locationMarker","updateOfflineNotice","initMap","initForm","initCamera","notice","style","display","e","latlng","draggable","ev","pos","getLatLng","form","photoInput","preview","cancelBtn","file","files","r","FileReader","onload","readAsDataURL","async","evt","preventDefault","photoFile","alert","saveStoryOffline","reader","photoData","pending","now","cameraBtn","stream","mediaDevices","getUserMedia","video","srcObject","capture","canvas","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","blob","File","type","dt","DataTransfer","items","toDataURL","getTracks","t","stop","errorMessage","value","setItem","loginResult","userId","textContent","pushService","toggleBtn","testBtn","refreshBtn","backBtn","updateStatus","disabled","updateNotificationStatus","toggleSubscription","sendTestNotification","permissionEl","subscriptionInfoEl","formatPermission","statusEl2","color","VAPID_PUBLIC_KEY","actions","action","status","loadCachedStories","loadPendingStories","updateStats","syncPendingStories","performSearch","clearSearch","exportData","clearCache","container","html","substring","toLocaleString","trim","results","allStories","pendingStories","syncBtn","wasDisabled","syncedCount","errors","exportedAt","toISOString","cachedStories","dataStr","dataBlob","Blob","URL","createObjectURL","link","href","download","click","revokeObjectURL","confirm","extractPathnameSegments","path","splitUrl","split","resource","constructRouteFromSegments","pathSegments","pathname","concat","getActivePathname","navigationDrawer","drawerButton","content","_setupDrawer","isOpen","_setupKeyboardNavigation","tagName","renderPage","page","startViewTransition","setTimeout","app","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call","m","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","Object","keys","every","n","getter","__esModule","d","a","definition","o","defineProperty","enumerable","obj","prop","hasOwnProperty","Symbol","toStringTag","p","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","bind","__webpack_exports__"],"sourceRoot":""}